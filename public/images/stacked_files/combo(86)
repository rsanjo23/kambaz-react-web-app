YUI.add("hermes-template-photo-page-sidebar",(function(t,e){var l=t.Template.Handlebars.revive({1:function(t,e,l,n,a){return" getty-widget"},3:function(t,e,l,n,a){var o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"\t\t\t"+t.escapeExpression((o(l,"outlet")||e&&o(e,"outlet")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},null!=e?o(e,"getty-widget-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:11,column:3},end:{line:11,column:31}}}))+"\n"},5:function(t,e,l,n,a){return'\t\t\t<div class="moola-detached-container"></div>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,l,n,a){var o,i=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,u=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="sidebar-main-container" style="width: '+u((s(l,"flickrConfig")||e&&s(e,"flickrConfig")||r).call(i,"photopage.sidebarWidth",{name:"flickrConfig",hash:{},data:a,loc:{start:{line:1,column:50},end:{line:1,column:91}}}))+'px;">\n\t'+u((s(l,"outlet")||e&&s(e,"outlet")||r).call(i,null!=e?s(e,"attribution-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:2,column:1},end:{line:2,column:28}}}))+'\n\t<div class="scrollable-container">\n\t\t'+u((s(l,"outlet")||e&&s(e,"outlet")||r).call(i,null!=e?s(e,"sub-photo-title-desc-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:4,column:2},end:{line:4,column:38}}}))+"\n\t\t"+u((s(l,"outlet")||e&&s(e,"outlet")||r).call(i,null!=e?s(e,"sub-photo-right-stats-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:5,column:2},end:{line:5,column:39}}}))+"\n\t\t"+u((s(l,"outlet")||e&&s(e,"outlet")||r).call(i,null!=e?s(e,"sub-photo-date-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:6,column:2},end:{line:6,column:32}}}))+"\n\t\t"+u((s(l,"outlet")||e&&s(e,"outlet")||r).call(i,null!=e?s(e,"photo-charm-exif-scrappy-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:7,column:2},end:{line:7,column:42}}}))+'\n\t</div>\n\t<div class="moola-content-spacing'+(null!=(o=s(l,"if").call(i,null!=e?s(e,"showGettyWidget"):e,{name:"if",hash:{},fn:t.program(1,a,0),inverse:t.noop,data:a,loc:{start:{line:9,column:34},end:{line:9,column:77}}}))?o:"")+'">\n'+(null!=(o=s(l,"if").call(i,null!=e?s(e,"showGettyWidget"):e,{name:"if",hash:{},fn:t.program(3,a,0),inverse:t.program(5,a,0),data:a,loc:{start:{line:10,column:2},end:{line:14,column:9}}}))?o:"")+"\t</div>\n</div>"},useData:!0}),n={};t.Array.each([],(function(e){var l=t.Template.get("hermes/"+e);l&&(n[e]=l)})),t.Template.register("hermes/photo-page-sidebar",(function(e,a){return(a=a||{}).partials=a.partials?t.merge(n,a.partials):n,l(e,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-page-sidebar-view",(function(e,t){let o=require("hermes-core/flog")(t);new e.SubscriptionsHelper;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,additionalViewClasses:["clear-float","photo-attribution"],parentViewName:this.name},"sub-photo-title-desc-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,parentViewName:this.name},"photo-charm-exif-scrappy-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,parentViewName:this.name},"sub-photo-right-stats-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,parentViewName:this.name},"sub-photo-date-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,parentViewName:this.name},"getty-widget-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,type:"photoPage",sidebar:!0,disabled:function(){return!this.appContext.gettyHelper.canShowWidgetType()||this.appContext.adManager.userCanViewPhotoPageSidebar()}}},initializer:function(t){return this.photoId=t.photoId,this.detachedConfig,this.showPhotoPageAd=!0,this.showGettyWidget=!1,this.nodeObserver,this.sidebarResizeThrottle=16,e.Promise.resolve()},loadState:function(){let t=this;return this.appContext.getModel("photo-models",t.photoId).then((function(i){if(t.set("photo",i),t.appContext.adManager.canShowAdWithPhoto(t.get("photo"))){if(t.appContext.flipper.isFlipped("enable-page-categorizations"))return t.appContext.getModel("page-categorizations-models",t.photoId).then((function(o){t.set("categories",o.getValue("categories")),e.Snowplough.sendSelfDescribingEvent({schema:e.Snowplough.SCHEMAS.PAGE_CATEGORIZATIONS,data:{photoId:[parseInt(t.photoId,10)],status:"received",categorizations:t.get("categories")}})})).catch((function(e){o.error("Error loading photo categorizations: ",e)}))}else t.showPhotoPageAd=!1}))},buildContainer:function(){this.setContainerWithTemplate("photo-page-sidebar",{showGettyWidget:this.showGettyWidget,sidebarWidth:e.config.flickr.photopage.sidebarWidth})},activate:function(){let t=!1,o=this.get("container"),i=this,a=i.get("photo");return this.registerEventHandler(o.one(".fave-count").on("click",this.faveCountClicked.bind(this))),this.registerEventHandler(o.one(".comment-count").on("click",this.commentCountClicked.bind(this))),this.registerEventHandler(e.on("resize",e.betterThrottle((t=>{this.showGettyWidget||(this.showPhotoPageAd&&this.appContext.viewportData.getWidthWithScrollbars()>=1081?e.one("body").one(".detached-moola-unit")||this.setDetachedMoolaUnit():e.one("body").one(".detached-moola-unit")&&this.appContext.adManager.removeDetachedAdUnit()),this.setCorrectSidebarHeight()}),this.sidebarResizeThrottle,this))),this.showGettyWidget?(a&&this.registerEventHandler(a.on("valuesChanged",(function(e){e.safetyLevel&&i.canShowGettyWidget()}))),this.canShowGettyWidget(),t=!1):this.showPhotoPageAd?this.appContext.viewportData.getWidthWithScrollbars()>=1081&&(t=!0):(o.one(".moola-content-spacing")&&o.one(".moola-content-spacing").setStyle("display","none"),this.appContext.adManager.destroyAdUnitsOnPage(!0)),this.setCorrectSidebarHeight(),t&&this.setDetachedMoolaUnit(),this.setSiblingObserver(),e.Promise.resolve()},canShowGettyWidget:function(){let e=this.showGettyWidget,t=this.get("photo");this.appContext.adManager.canShowAdWithPhoto(t)&&this.appContext.gettyHelper.canShowWidgetType()?this.showGettyWidget=!1:this.showGettyWidget=!0,e!==this.showGettyWidget&&this.buildContainer()},faveCountClicked:function(t,o){t.preventDefault();var i=new e.Views["photo-faves-list-view"]({photoId:this.photoId,appContext:this.appContext});this.favesModal=new e.Views.FluidModal({appContext:this.appContext,subview:i,height:550,flexLayout:!0,hasSubviewConfigRefactor:!0}),this.favesModal.show()},commentCountClicked:function(){var t={appContext:this.appContext,photoId:this.photoId,isScrollable:!0,hasHeader:!0},o=new e.ModalDroparoundHelper(this.appContext,{useViewportType:!1,containerType:"modal",configs:{common:{subviewName:"photo-comments-view",subviewParams:t},modal:{height:550,flexLayout:!0}}});this.registerEventHandler(o.on("close",(()=>{e.fire("photoCommentModalClosed",{photoId:this.photoId})}))),this.registerEventHandler(e.on("addComment:showingSignupModal",(()=>{o.close()}))),o.show()},setCorrectSidebarHeight:function(){let t,o,i=this.get("container"),a=e.one("body").one(".height-controller");i&&a&&i.one(".scrollable-container")&&(t=i.get("offsetHeight"),o=a.get("offsetHeight"),(o<t||o>t)&&i.setStyle("maxHeight",`${o}px`))},setDetachedMoolaUnit:function(){const t=this,o=this.get("container"),i=e.config.flickr.moola.positions.photopage[0],a=this.appContext.viewportData.getWidthWithScrollbars(),n=e.config.flickr.moola.ad_breakpoint_mobile_desktop;this.adConfig={adUnit:i[a<n?"ad_unit_mobile":"ad_unit_desktop"]},this.adEventStitch=this.appContext.adManager.getHashedAdValue(this.appContext.adManager.getAdPositioning(o)),this.adUnit=this.adConfig.adUnit,this.detachedConfig={template:this.templates("prbd-moola-position")({adUnit:this.adConfig.adUnit,advertisingStitching:this.adEventStitch,categories:this.appContext.flipper.isFlipped("enable-page-categorizations")?this.appContext.adManager.getAdCategories(this.get("categories")):"",class:"detached-moola-unit"}),detachedContainer:e.one("body").one("#detached-moola-container"),anchorNode:o.one(".moola-detached-container"),route:"photo-route"},this.registerEventHandler(e.on("resize",e.betterThrottle((e=>{this.appContext.adManager.repositionDetachedMoolaUnit(this.detachedConfig)}),this.sidebarResizeThrottle,this))),document.querySelector(".detached-moola-unit")||(this.appContext.adManager.initDetachedMoolaUnit(this.detachedConfig),this.appContext.adManager.processAdsOnPage(),this.appContext.adManager.signalAdRequest(this),this.detachedSanityCheck=setTimeout((function(){t.appContext.adManager.repositionDetachedMoolaUnit(t.detachedConfig),this.appContext.adManager.processAdsOnPage(),this.appContext.adManager.signalAdRequest(this),clearTimeout(t.detachedSanityCheck)}),500))},setSiblingObserver:function(){const e=this.get("container").getDOMNode();this.nodeObserver=new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&(this.get("container").one(".moola-detached-container")&&this.showPhotoPageAd?(this.setCorrectSidebarHeight(),this.appContext.adManager.repositionDetachedMoolaUnit(this.detachedConfig)):this.setCorrectSidebarHeight())}))}));this.nodeObserver.observe(e,{childList:!0,subtree:!0})},destructor:function(){this.nodeObserver&&this.nodeObserver.disconnect&&this.nodeObserver.disconnect(),this.appContext.adManager.nextPhotoIsAdFriendly()||this.appContext.adManager.destroyAdUnitsOnPage(!0)}},{})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-sidebar","hermes-template-prbd-moola-position","attribution-view","sub-photo-title-desc-view","photo-charm-exif-scrappy-view","sub-photo-right-stats-view","sub-photo-date-view","photo-license-view","fluid-modal-view","fluid-droparound-view","getty-widget-view"],optionalRequires:["hermes-core"],optional:["photo-models"],langBundles:["photo-page-scrappy","common"]});